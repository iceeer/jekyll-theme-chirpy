---
layout: post
status: publish
published: true
title: Freemarker学习
author:
  display_name: iceeer
  login: iceeer
  email: superuser@xystoy.com
  url: ''
author_login: iceeer
author_email: superuser@xystoy.com
wordpress_id: 2078
wordpress_url: http://blog.xystoy.com/?p=2078
date: '2013-12-28 21:41:41 +0800'
date_gmt: '2013-12-28 13:41:41 +0800'
categories:
- 开发
- Java
tags: []
comments: []
---
<p>一、&nbsp; Sequence的内置函数</p>
<p>1.&nbsp;&nbsp;sequence?first 返回sequence的第一个值。</p>
<p>2.&nbsp;&nbsp;sequence?last&nbsp; 返回sequence的最后一个值。</p>
<p>3.&nbsp;&nbsp;sequence?reverse 将sequence的现有顺序反转，即倒序排序</p>
<p>4.&nbsp;&nbsp;sequence?size&nbsp;&nbsp;&nbsp; 返回sequence的大小</p>
<p>5.&nbsp;&nbsp;sequence?sort&nbsp;&nbsp;&nbsp; 将sequence中的对象转化为字符串后顺序排序</p>
<p>6.&nbsp;&nbsp;sequence?sort_by(value) 按sequence中对象的属性value进行排序</p>
<p>二、&nbsp;&nbsp;&nbsp;Hash的内置函数</p>
<p>1.&nbsp;&nbsp;hash?keys 返回hash里的所有key,返回结果为sequence</p>
<p>2.&nbsp;&nbsp;hash?values 返回hash里的所有value,返回结果为sequence</p>
<p>例如：</p>
<p><#assign user={&ldquo;name&rdquo;:&ldquo;hailang&rdquo;, &ldquo;sex&rdquo;:&ldquo;man&rdquo;}></p>
<p><#assign keys=user?keys></p>
<p><#list keys as key></p>
<p>${key}=${user[key]}</p>
<p></#list></p>
<p>三、&nbsp;&nbsp;&nbsp;操作字符串函数</p>
<p>1.&nbsp;&nbsp;&nbsp;substring（start,end）从一个字符串中截取子串</p>
<p>start:截取子串开始的索引，start必须大于等于0，小于等于end</p>
<p>end: 截取子串的长度，end必须大于等于0，小于等于字符串长度，如果省略该参数，默认为字符串长度。</p>
<p>例子：</p>
<p>${&lsquo;str&rsquo;?substring(0)},结果为str</p>
<p>${&lsquo;str&rsquo;?substring(1)},结果为tr</p>
<p>${&lsquo;str&rsquo;?substring(2)},结果为r</p>
<p>${&lsquo;str&rsquo;?substring(3)},结果为</p>
<p>${&lsquo;str&rsquo;?substring(0,0)},结果为</p>
<p>${&lsquo;str&rsquo;?substring(0,1)},结果为s</p>
<p>${&lsquo;str&rsquo;?substring(0,2)},结果为st</p>
<p>${&lsquo;str&rsquo;?substring(0,3)},结果为str</p>
<p>2.&nbsp;&nbsp;&nbsp;cap_first 将字符串中的第一个单词的首字母变为大写。</p>
<p>${&lsquo;str&rsquo;?cap_first},结果为Str</p>
<p>3.&nbsp;&nbsp;&nbsp;uncap_first将字符串中的第一个单词的首字母变为小写。</p>
<p>${&lsquo;Str&rsquo;?cap_first},结果为str</p>
<p>4.&nbsp;&nbsp; capitalize将字符串中的所有单词的首字母变为大写</p>
<p>${&lsquo;str&rsquo;?capitalize},结果为STR</p>
<p>5.&nbsp;&nbsp;&nbsp;&nbsp;date,time,datetime将字符串转换为日期</p>
<p>例如：</p>
<p><#assign date1=&rdquo;2009-10-12&rdquo;?date(&ldquo;yyyy-MM-dd&rdquo;)></p>
<p><#assign date2=&rdquo;9:28:20&rdquo;?time(&ldquo;HH:mm:ss&rdquo;)></p>
<p><#assign date3=&rdquo; 2009-10-12 9:28:20&rdquo;?time(&ldquo;HH:mm:ss&rdquo;)></p>
<p>${date1},结果为2009-10-12</p>
<p>${date2},结果为9:28:20</p>
<p>${date3},结果为2009-10-12 9:28:20</p>
<p>注意：如果指定的字符串格式不正确将引发错误。</p>
<p>6.&nbsp;&nbsp;ends_with 判断某个字符串是否由某个子串结尾，返回布尔值。</p>
<p>${&ldquo;string&rdquo;?ends_with(&ldquo;ing&rdquo;)?string}, 返回结果为true</p>
<p>注意：布尔值必须转换为字符串才能输出</p>
<p>7.&nbsp;&nbsp;&nbsp;html 用于将字符串中的<、>、&amp;和&ldquo;替换为对应得&amp;lt;&amp;gt;&amp;quot:&amp;amp</p>
<p>8.&nbsp;&nbsp;&nbsp;index_of（substring,start）在字符串中查找某个子串，返回找到子串的第一个字符的索引，如果没有找到子串，则返回-1。</p>
<p>Start参数用于指定从字符串的那个索引处开始搜索，start为数字值。</p>
<p>如果start大于字符串长度，则start取值等于字符串长度，如果start小于0， 则start取值为0。</p>
<p>${&ldquo;string&rdquo;?index_of(&ldquo;in&rdquo;) ,结果为3</p>
<p>${&ldquo;string&rdquo;?index_of(&ldquo;ab&rdquo;) ,结果为-1</p>
<p>9.&nbsp;&nbsp;&nbsp;&nbsp;length返回字符串的长度 ${&ldquo;string&rdquo;?length},结果为6</p>
<p>10.&nbsp; lower_case将字符串转为小写</p>
<p>${&ldquo;STRING&rdquo;?lower_case},结果为string</p>
<p>11.&nbsp;&nbsp;upper_case将字符串转为大写</p>
<p>${&ldquo;string&rdquo;?upper_case},结果为STRING</p>
<p>12.&nbsp;&nbsp;&nbsp;contains 判断字符中是否包含某个子串。返回布尔值</p>
<p>${&ldquo;string&rdquo;?contains(&ldquo;ing&rdquo;)?string} ,结果为true</p>
<p>注意：布尔值必须转换为字符串才能输出</p>
<p>13.&nbsp; number将字符串转换为数字</p>
<p>${&ldquo;111.11&rdquo;?number},结果为111.11</p>
<p>14.&nbsp;&nbsp;replace用于将字符串中的一部分从左到右替换为另外的字符串。</p>
<p>${&ldquo;strabg&rdquo;?replace(&ldquo;ab&rdquo;,&rdquo;in&rdquo;)} ,结果为string</p>
<p>15.&nbsp;&nbsp;&nbsp;split使用指定的分隔符将一个字符串拆分为一组字符串</p>
<p><#list &ldquo;This|is|split&rdquo;?split(&ldquo;|&rdquo;) as s></p>
<p>${s}</p>
<p></#list></p>
<p>结果为:</p>
<p>This</p>
<p>is</p>
<p>split</p>
<p>16.&nbsp;&nbsp;&nbsp;trim 删除字符串首尾空格 ${&ldquo;&nbsp; String &rdquo;?trim} ,结果为String</p>
<p>四、&nbsp; 操作数字</p>
<p>1.&nbsp; c 用于将数字转换为字符串</p>
<p>${123?c},结果为123</p>
<p>2.&nbsp;&nbsp;string用于将数字转换为字符串</p>
<p>Freemarker中预订义了三种数字格式：number,currency（货币）和percent(百分比)其中number为默认的数字格式转换</p>
<p>例如：</p>
<p><#assign tempNum=20></p>
<p>${tempNum}</p>
<p>${tempNum?string.number}或${tempNum?string(&ldquo;number&rdquo;)} ,结果为20</p>
<p>${tempNum?string.currency}或${tempNum?string(&ldquo;currency&rdquo;)} ,结果为￥20.00</p>
<p>${tempNum?string. percent}或${tempNum?string(&ldquo;percent&rdquo;)} ,结果为2,000%</p>
<p>五、&nbsp;&nbsp;操作布尔值</p>
<p>string 用于将布尔值转换为字符串输出</p>
<p>true转为&ldquo;true&rdquo;，false转换为&ldquo;false&rdquo;</p>
<p>foo?string(&ldquo;yes&rdquo;,&rdquo;no&rdquo;),如果布尔值是true,那么返回&ldquo;yes&rdquo;,否则返回no</p>
<p>&nbsp;</p>
<p>自定义函数</p>
<p><strong>1. 编写函数</strong></p>
<p>&nbsp;</p>
<p>public class FtlCheckPermissionMethod implements TemplateMethodModel {</p>
<p>@SuppressWarnings("rawtypes")<br />
@Override<br />
public Object exec(List args) throws TemplateModelException {<br />
String permissionsStr = args.get(0).toString();<br />
String permission = args.get(1).toString();<br />
String[] permissionsArray = permissionsStr.split(SessionUtil.PERMISSION_SPLIT);<br />
for (String per : permissionsArray) {<br />
if (permission.equals(per)) {<br />
return true;<br />
}<br />
}</p>
<p>return false;<br />
}<br />
}</p>
<p><strong>2.注册与使用</strong></p>
<p>有两种方式:</p>
<p>(1).在模板文件中注册,在模板中使用</p>
<p>&nbsp;</p>
<p><#assign checkPermission= "com.beyondsoft.common.util.FtlCheckPermissionMethod"?new()><br />
<#macro leftMenu menu></p>
<div class="left_block clearfix">
<div class="leftmenu">
<ul>
<#if checkPermission(permissions,"VW_ACCOUNT")></p>
<li <#if menu == "Account_Management">class="on"</#if>><a href="javascript:windowLocationHref('${base}/account/initAddNewAccount.do');">Account Management</a></li>
<p></#if><br />
<#if checkPermission(permissions,"VW_ROLE_MANAGEMENT")></p>
<li <#if menu == "Role_Management">class="on"</#if>><a href="javascript:windowLocationHref('${base}/role/initRoleManagement.do');">Role Management</a></li>
<p></#if><br />
<#if checkPermission(permissions,"VW_RESET_PASSWORD")></p>
<li <#if menu == "Reset_Password">class="on"</#if>><a href="javascript:windowLocationHref('${base}/reset/initReset.do');">Reset Password</a></li>
<p></#if><br />
<#if checkPermission(permissions,"VW_REVIEW_HISTORY")></p>
<li <#if menu == "Review_History">class="on"</#if>><a href="javascript:windowLocationHref('${base}/review/review.do');">Review History</a></li>
<p></#if>
</ul>
</div>
<p><span></span>
</div>
<p></#macro></p>
<p>&nbsp;</p>
<p>(2).处理模板文件时注册</p>
<p>Map<String,Object> root=new HashMap<String, Object>();<br />
root.put("getSysdate", new StringLengthMethod());<br />
Configuration config=new Configuration();<br />
File file=new File(templatePath); //并加载模板文件<br />
config.setDirectoryForTemplateLoading(file); //设置包装器，并将对象包装为数据模型<br />
config.setObjectWrapper(new DefaultObjectWrapper()); //获取模板,并设置编码方式，这个编码必须要与页面中的编码格式一致<br />
Template template=config.getTemplate(templateName,templateEncoding); //合并数据模型与模板<br />
template.process(root, out);</p>
<p>&nbsp;</p>
<p>链接：<a href="http://my.oschina.net/u/265431/blog/75436">Freemarker内置函数,数字,字符串,日期格式化</a></p>
<h3><a href="http://hbzwt.iteye.com/blog/1225091">Freemarker自定义函数的使用</a></h3>
